{% extends "admin/admin_base.html" %} {% block content %}

<div class="container-fluid">
  <div class="row">
    <!-- Charts Area -->
    <div class="col-lg-12 p-4">
      <div class="row">
        <!-- Chart 1: Status (Pie) -->
        <div class="col-lg-4 mb-4">
          <div class="card shadow rounded-4">
            <div class="card-body text-center">
              <h5 class="text-primary mb-3">Task Status Overview</h5>
              <div style="height: 300px">
                <canvas id="statusChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart 2: Priority (Bar) -->
        <div class="col-lg-4 mb-4">
          <div class="card shadow rounded-4">
            <div class="card-body text-center">
              <h5 class="text-primary mb-3">Task Priority Statistics</h5>
              <div style="height: 300px">
                <canvas id="priorityChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart 3: Completion (Bar) -->
        <div class="col-lg-4 mb-4">
          <div class="card shadow rounded-4">
            <div class="card-body text-center">
              <h5 class="text-primary mb-3">Task Completion Trend</h5>
              <div style="height: 300px">
                <canvas id="completionChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js and Plugin -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

<script>
  // Pie Chart: Task Status Overview
  const statusChart = new Chart(document.getElementById('statusChart'), {
    type: 'pie',
    data: {
      labels: ['Pending', 'In Progress', 'Completed'],
      datasets: [{
        data: [{{ pending }}, {{ inprogress }}, {{ completed }}],
        backgroundColor: ['#f1c40f', '#1abc9c', '#2ecc71']
      }]
    },
    options: {
      plugins: {
        datalabels: {
          color: '#000',
          font: { weight: 'bold' },
          formatter: (value, ctx) => {
            const total = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
            const percent = ((value / total) * 100).toFixed(1);
            return `${value} (${percent}%)`;
          }
        },
        legend: { position: 'bottom' }
      },
      maintainAspectRatio: false
    },
    plugins: [ChartDataLabels]
  });

  // Bar Chart: Task Priority
  const priorityChart = new Chart(document.getElementById('priorityChart'), {
    type: 'bar',
    data: {
      labels: ['High', 'Medium', 'Low'],
      datasets: [{
        label: 'Task Priority',
        data: [{{ high }}, {{ medium }}, {{ low }}],
        backgroundColor: ['#e74c3c', '#f39c12', '#27ae60']
      }]
    },
    options: {
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        datalabels: {
          color: '#fff',
          anchor: 'center',
          align: 'center',
          font: { weight: 'bold' }
        }
      },
      scales: {
        y: { beginAtZero: true }
      }
    },
    plugins: [ChartDataLabels]
  });

  // Bar Chart: Task Completion
  const completionChart = new Chart(document.getElementById('completionChart'), {
    type: 'bar',
    data: {
      labels: ['Pending', 'In Progress', 'Completed'],
      datasets: [{
        label: 'Task Completion',
        data: [{{ pending }}, {{ inprogress }}, {{ completed }}],
        backgroundColor: ['#f1c40f', '#1abc9c', '#2ecc71']
      }]
    },
    options: {
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        datalabels: {
          color: '#fff',
          anchor: 'center',
          align: 'center',
          font: { weight: 'bold' }
        }
      },
      scales: {
        y: { beginAtZero: true }
      }
    },
    plugins: [ChartDataLabels]
  });
</script>

{% endblock %}
